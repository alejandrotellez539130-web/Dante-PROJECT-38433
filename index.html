<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DANTE TACTICS v9.0</title>
    <style>
        body { background-color: #050505; color: #cfcfcf; font-family: 'Consolas', monospace; padding: 10px; text-align: center; overflow-x: hidden; }
        h1 { border-bottom: 1px solid #d4af37; padding-bottom: 5px; color: #d4af37; letter-spacing: 2px; font-size: 1.2em; }
        
        /* ZONA DE INPUT */
        .control-panel { margin-bottom: 20px; border: 1px solid #333; padding: 15px; background: #0a0a0a; }
        input { background: #000; border: 1px solid #444; color: #d4af37; padding: 10px; width: 70%; text-align: center; }
        button { background: #111; color: #d4af37; border: 1px solid #d4af37; padding: 10px 20px; font-weight: bold; margin-top: 10px; }
        
        /* EL TABLERO (GRID 5x5) */
        .board-container { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 4px; 
            max-width: 400px; 
            margin: 0 auto; 
            background: #111;
            padding: 5px;
            border: 2px solid #333;
        }
        
        .cell { 
            aspect-ratio: 1; 
            background: #080808; 
            border: 1px solid #222; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.5em;
            position: relative;
        }
        
        /* ZONAS DEL TABLERO (VISUAL) */
        .zone-virgilio { background: #0f1a0f; box-shadow: inset 0 0 10px #002200; } /* Centro */
        .zone-interaccion { background: #1a1a10; } /* Medio */
        .zone-caos { background: #1a0f0f; } /* Borde */

        /* ESTILOS DE PIEZAS */
        .piece { animation: spawn 0.5s ease-out; font-size: 0.7em; text-align: center; line-height: 1; }
        .type-raiz { color: #88ff88; text-shadow: 0 0 5px #00ff00; }
        .type-virtud { color: #88ffff; text-shadow: 0 0 5px #00ffff; }
        .type-sombra { color: #ff8888; text-shadow: 0 0 5px #ff0000; }
        .type-exceso { color: #ff00ff; text-shadow: 0 0 5px #ff00ff; font-weight: bold; }

        /* REPORTE */
        #tactical-report { margin-top: 20px; text-align: left; font-size: 0.8em; color: #888; border-top: 1px solid #333; padding-top: 10px; }

        @keyframes spawn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <h1>DANTE TACTICS v9.0</h1>

    <div class="control-panel">
        <input type="text" id="userInput" placeholder="NOMBRE / AGENTE" autocomplete="off">
        <button onclick="manifestarPieza()">MATERIALIZAR</button>
    </div>

    <div id="board" class="board-container">
        </div>

    <div id="tactical-report">Esperando emergencia de piezas...</div>

    <script src="dante_totem_db.js"></script>
    <script>
        // CONFIGURACI√ìN DEL MOTOR
        const BOARD_SIZE = 5;
        const CENTER = 2; // √çndice 2 (0,1,2,3,4)

        // Definici√≥n de Zonas (L√≥gica espacial)
        function getZoneType(x, y) {
            const dist = Math.max(Math.abs(x - CENTER), Math.abs(y - CENTER));
            if (dist === 0) return "virgilio"; // Centro exacto
            if (dist === 1) return "interaccion"; // Anillo medio
            return "caos"; // Borde exterior
        }

        // GENERADOR DE TABLERO INICIAL
        function initBoard() {
            const board = document.getElementById("board");
            board.innerHTML = "";
            for (let y = 0; y < BOARD_SIZE; y++) {
                for (let x = 0; x < BOARD_SIZE; x++) {
                    const cell = document.createElement("div");
                    cell.className = `cell zone-${getZoneType(x, y)}`;
                    cell.id = `cell-${x}-${y}`;
                    // Coordenadas sutiles
                    // cell.innerHTML = `<span style="font-size:0.2em; opacity:0.3; position:absolute; top:2px; left:2px;">${x},${y}</span>`;
                    board.appendChild(cell);
                }
            }
        }

        // --- MOTOR MATEM√ÅTICO ---
        const DANTE_ENGINE = {
            textToDNA: (text) => {
                if (!text || text.trim().length < 2) return null;
                let hash = 0;
                for (let i = 0; i < text.length; i++) { hash = (hash << 5) - hash + text.charCodeAt(i); hash &= 0xff; }
                return Math.abs(hash);
            },
            getMeyi: (dna) => (dna % 16) + 1,
            getSeed: () => (Math.floor(Date.now() / 1000) ^ (Math.floor(Date.now() / 1000) >> 8)) & 0xff
        };

        function manifestarPieza() {
            // 1. Limpieza
            initBoard(); 
            const rawName = document.getElementById("userInput").value;
            const output = document.getElementById("tactical-report");
            
            if (!rawName) return;

            // 2. C√°lculo
            const userDNA = DANTE_ENGINE.textToDNA(rawName);
            const seed = DANTE_ENGINE.getSeed();
            const odu = userDNA ^ seed;
            const pressure = parseFloat((odu / 255).toFixed(3));
            const meyiID = DANTE_ENGINE.getMeyi(userDNA);

            // 3. Consultar DB
            if (typeof TOTEM_SYSTEM === 'undefined') { output.innerHTML = "‚ùå ERROR: DB no cargada"; return; }
            const tactical = TOTEM_SYSTEM.getEstadoTactico(meyiID, pressure);

            // 4. CLASIFICACI√ìN DE PIEZA (Tu Regla #2)
            let tipoPieza = "raiz"; // Default
            if (pressure > 0.38 && pressure <= 0.618) tipoPieza = "virtud";
            if (pressure > 0.618 && pressure <= 0.85) tipoPieza = "sombra";
            if (pressure > 0.85) tipoPieza = "exceso";

            // 5. L√ìGICA DE SPAWN (Regla #5 - Zonas)
            // ¬øD√≥nde aparece la pieza seg√∫n su naturaleza?
            let targetX, targetY;
            
            if (tipoPieza === "raiz") { 
                // Ra√≠z busca estabilidad (Centro)
                targetX = CENTER; targetY = CENTER;
            } else if (tipoPieza === "virtud") {
                // Virtud busca expansi√≥n (Anillo Medio - Aleatorio)
                // Genera coordenadas que disten 1 del centro
                do {
                    targetX = Math.floor(Math.random() * BOARD_SIZE);
                    targetY = Math.floor(Math.random() * BOARD_SIZE);
                } while (getZoneType(targetX, targetY) !== "interaccion");
            } else {
                // Sombra y Exceso buscan el Caos (Bordes - Aleatorio)
                do {
                    targetX = Math.floor(Math.random() * BOARD_SIZE);
                    targetY = Math.floor(Math.random() * BOARD_SIZE);
                } while (getZoneType(targetX, targetY) !== "caos");
            }

            // 6. RENDERIZADO
            const targetCell = document.getElementById(`cell-${targetX}-${targetY}`);
            
            // Iconograf√≠a simple seg√∫n tipo
            const iconMap = { "raiz": "üå±", "virtud": "‚ú®", "sombra": "üëÅÔ∏è", "exceso": "üî•" };
            
            targetCell.innerHTML = `
                <div class="piece type-${tipoPieza}">
                    <div style="font-size:2em">${iconMap[tipoPieza]}</div>
                    <div>${tactical.manifestation}</div>
                </div>
            `;

            // Reporte
            output.innerHTML = `
> MEYI #${meyiID}: ${tactical.identity}
> PRESI√ìN: ${pressure}
> CLASE: ${tipoPieza.toUpperCase()}
> EFECTO: ${getDescripcionEfecto(tipoPieza)}
> ZONA DE APARICI√ìN: ${getZoneType(targetX, targetY).toUpperCase()}
            `;
        }

        function getDescripcionEfecto(tipo) {
            if (tipo === "raiz") return "Estabiliza el centro. Inmune.";
            if (tipo === "virtud") return "Expande influencia a casillas vecinas.";
            if (tipo === "sombra") return "Genera tensi√≥n. Bloquea paso.";
            if (tipo === "exceso") return "TRANSFORMA el tablero. Peligro.";
            return "N/A";
        }

        // Iniciar vac√≠o
        initBoard();
    </script>
</body>
</html>
