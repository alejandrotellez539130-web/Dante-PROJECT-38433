<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DANTE TACTICS</title>
    <style>
        body { background-color: #050505; color: #cfcfcf; font-family: 'Consolas', monospace; padding: 10px; text-align: center; overflow-x: hidden; }
        h1 { border-bottom: 1px solid #d4af37; padding-bottom: 5px; color: #d4af37; letter-spacing: 2px; font-size: 1.2em; }
        
        /* PANEL DE CONTROL */
        .control-panel { margin-bottom: 20px; border: 1px solid #333; padding: 15px; background: #0a0a0a; }
        input { background: #000; border: 1px solid #444; color: #d4af37; padding: 10px; width: 70%; text-align: center; }
        button { background: #111; color: #d4af37; border: 1px solid #d4af37; padding: 10px 20px; font-weight: bold; margin-top: 10px; }
        
        /* EL TABLERO (GRID 5x5) */
        .board-container { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 4px; 
            max-width: 400px; 
            margin: 0 auto; 
            background: #111;
            padding: 5px;
            border: 2px solid #333;
        }
        
        .cell { 
            aspect-ratio: 1; 
            background: #080808; 
            border: 1px solid #222; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.5em;
            position: relative;
        }
        
        /* ZONAS DEL TABLERO */
        .zone-virgilio { background: #0f1a0f; box-shadow: inset 0 0 10px #002200; } /* Centro */
        .zone-interaccion { background: #1a1a10; } /* Medio */
        .zone-caos { background: #1a0f0f; } /* Borde */

        /* PIEZAS */
        .piece { animation: spawn 0.5s ease-out; font-size: 0.7em; text-align: center; line-height: 1; }
        .type-raiz { color: #88ff88; text-shadow: 0 0 5px #00ff00; }
        .type-virtud { color: #88ffff; text-shadow: 0 0 5px #00ffff; }
        .type-sombra { color: #ff8888; text-shadow: 0 0 5px #ff0000; }
        .type-exceso { color: #ff00ff; text-shadow: 0 0 5px #ff00ff; font-weight: bold; }

        /* REPORTE DE TEXTO */
        #tactical-report { margin-top: 20px; text-align: left; font-size: 0.9em; color: #aaa; border-top: 1px solid #333; padding: 15px; background: #080808; white-space: pre-wrap; }
        .quote-box { margin-top: 10px; padding: 10px; border-left: 3px solid #d4af37; font-style: italic; color: #888; font-size: 0.9em; background: #0d0d0d; }

        @keyframes spawn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <h1>DANTE TACTICS</h1>

    <div class="control-panel">
        <input type="text" id="userInput" placeholder="NOMBRE / AGENTE" autocomplete="off">
        <button onclick="manifestarPieza()">MATERIALIZAR</button>
    </div>

    <div id="board" class="board-container"></div>

    <div id="tactical-report">Esperando emergencia de piezas...</div>

    <script src="dante_totem_db.js"></script>

    <script>
        // --- CONFIGURACI√ìN DEL TABLERO ---
        const BOARD_SIZE = 5;
        const CENTER = 2; // El centro de 0 a 4 es 2

        // Definir Zonas (Centro, Interacci√≥n, Caos)
        function getZoneType(x, y) {
            const dist = Math.max(Math.abs(x - CENTER), Math.abs(y - CENTER));
            if (dist === 0) return "virgilio";
            if (dist === 1) return "interaccion";
            return "caos";
        }

        function initBoard() {
            const board = document.getElementById("board");
            board.innerHTML = "";
            for (let y = 0; y < BOARD_SIZE; y++) {
                for (let x = 0; x < BOARD_SIZE; x++) {
                    const cell = document.createElement("div");
                    cell.className = `cell zone-${getZoneType(x, y)}`;
                    cell.id = `cell-${x}-${y}`;
                    board.appendChild(cell);
                }
            }
        }

        // --- MOTOR MATEM√ÅTICO ---
        const DANTE_ENGINE = {
            textToDNA: (text) => {
                if (!text || text.trim().length < 2) return null;
                let hash = 0;
                for (let i = 0; i < text.length; i++) { hash = (hash << 5) - hash + text.charCodeAt(i); hash &= 0xff; }
                return Math.abs(hash);
            },
            getMeyi: (dna) => (dna % 16) + 1,
            getSeed: () => (Math.floor(Date.now() / 1000) ^ (Math.floor(Date.now() / 1000) >> 8)) & 0xff
        };

        // --- FUNCI√ìN PRINCIPAL ---
        function manifestarPieza() {
            initBoard(); 
            const rawName = document.getElementById("userInput").value;
            const output = document.getElementById("tactical-report");
            
            if (!rawName) return;

            // 1. C√°lculo Oculto
            const userDNA = DANTE_ENGINE.textToDNA(rawName);
            const seed = DANTE_ENGINE.getSeed();
            const odu = userDNA ^ seed;
            const pressure = parseFloat((odu / 255).toFixed(3));
            const meyiID = DANTE_ENGINE.getMeyi(userDNA);

            // 2. Consultar Base de Datos
            if (typeof TOTEM_SYSTEM === 'undefined') { output.innerHTML = "‚ùå ERROR: Base de datos no cargada."; return; }
            const tactical = TOTEM_SYSTEM.getEstadoTactico(meyiID, pressure);

            // 3. Limpiar Nombre de Familia (Quitar lo que est√° entre par√©ntesis)
            const familiaLimpia = tactical.identity.split(" (")[0];

            // 4. Clasificar Tipo de Pieza (Reglas de Presi√≥n)
            let tipoPieza = "raiz"; 
            if (pressure > 0.38 && pressure <= 0.618) tipoPieza = "virtud";
            if (pressure > 0.618 && pressure <= 0.85) tipoPieza = "sombra";
            if (pressure > 0.85) tipoPieza = "exceso";

            // 5. Determinar Posici√≥n en Tablero
            let targetX, targetY;
            if (tipoPieza === "raiz") { 
                targetX = CENTER; targetY = CENTER; // Siempre al centro
            } else if (tipoPieza === "virtud") {
                do { targetX = Math.floor(Math.random() * BOARD_SIZE); targetY = Math.floor(Math.random() * BOARD_SIZE); } 
                while (getZoneType(targetX, targetY) !== "interaccion");
            } else { // Sombra y Exceso
                do { targetX = Math.floor(Math.random() * BOARD_SIZE); targetY = Math.floor(Math.random() * BOARD_SIZE); } 
                while (getZoneType(targetX, targetY) !== "caos");
            }

            // 6. Dibujar Pieza
            const targetCell = document.getElementById(`cell-${targetX}-${targetY}`);
            const iconMap = { "raiz": "üå±", "virtud": "‚ú®", "sombra": "üëÅÔ∏è", "exceso": "üî•" };
            
            targetCell.innerHTML = `
                <div class="piece type-${tipoPieza}">
                    <div style="font-size:2em">${iconMap[tipoPieza]}</div>
                    <div>${tactical.manifestation}</div>
                </div>
            `;

            // 7. Generar Reporte Limpio
            output.innerHTML = `
> T√ìTEM: <span style="color:#d4af37; font-weight:bold; font-size:1.2em;">${tactical.manifestation.toUpperCase()}</span>
> FAMILIA: ${familiaLimpia}
> CLASE: <span class="type-${tipoPieza}">${tipoPieza.toUpperCase()}</span> ${iconMap[tipoPieza]}
> PRESI√ìN: ${pressure}
> EFECTO T√ÅCTICO: "${getDescripcionEfecto(tipoPieza)}"

<div class="quote-box">"${tactical.quote}"
‚Äî ${tactical.author}</div>
            `;
        }

        function getDescripcionEfecto(tipo) {
            if (tipo === "raiz") return "Estabiliza el centro. Punto de anclaje.";
            if (tipo === "virtud") return "Expande influencia a casillas vecinas.";
            if (tipo === "sombra") return "Genera tensi√≥n. Bloquea paso.";
            if (tipo === "exceso") return "TRANSFORMA el tablero. Peligro inminente.";
            return "N/A";
        }

        // Cargar tablero vac√≠o al inicio
        initBoard();
    </script>
</body>
</html>
