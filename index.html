<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA DANTE | CORTEX DEBUG</title>
    <style>
        body { background-color: #05070a; color: #00ff41; font-family: 'Courier New', monospace; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; border: 1px solid #004400; padding: 20px; box-shadow: 0 0 20px rgba(0,255,65,0.1); }
        h1 { text-align: center; border-bottom: 1px solid #004400; padding-bottom: 10px; }
        .input-zone { margin-top: 20px; border-top: 1px dashed #004400; padding-top: 20px; }
        
        input, button { width: 100%; padding: 15px; background: #001100; color: #00ff41; border: 1px solid #00ff41; margin-bottom: 10px; font-size: 16px; }
        button { font-weight: bold; cursor: pointer; text-transform: uppercase; }
        button:hover { background: #00ff41; color: #000; }
        
        .hidden { display: none; }
        .error-msg { color: #ff3333; font-weight: bold; background: #110000; padding: 10px; border: 1px solid red; margin-top: 10px; }
        #quote-display { font-size: 1.2em; color: #fff; font-style: italic; margin: 20px 0; border-left: 4px solid #00ff41; padding-left: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>SISTEMA DANTE v10.1<br><span style="font-size:0.5em; color:#00ffff;">[MODO ONLINE: GEMINI]</span></h1>
    
    <div id="console">>>> SISTEMA LISTO. ESPERANDO CREDENCIALES...<br></div>

    <div id="setup-form" class="input-zone">
        <p>>>> FECHA DE ORIGEN:</p>
        <input type="date" id="birthdate">
        <button id="btn-scan" onclick="iniciarConexion()">>>> INVOCAR INTELIGENCIA</button>
    </div>

    <div id="quiz-zone" class="input-zone hidden">
        <div id="quote-display"></div>
        <input type="text" id="author-guess" placeholder="¬øQui√©n dijo esto?" autocomplete="off">
        <button id="btn-verificar" onclick="verificarRespuesta()">CONFIRMAR AUTOR√çA</button>
        <p id="feedback-msg"></p>
    </div>
</div>

<script>
    // ======================================================
    // üõë PARE AQU√ç ARQUITECTO - ESTO ES LO IMPORTANTE
    // ======================================================
    
    // 1. Borra lo que hay dentro de las comillas abajo.
    // 2. Pega tu API KEY (la que empieza con AIza...)
    // 3. ASEG√öRATE de que las comillas "" sigan ah√≠.
    
    const API_KEY = "AIzaSyCwc4eOTk-7Jev_WkTWwNfG8p60i7GiT0E"; 

    // ======================================================

    let respuestaCorrecta = null; 

    async function iniciarConexion() {
        const fecha = document.getElementById('birthdate').value;
        const btn = document.getElementById('btn-scan');
        const consola = document.getElementById('console');

        // VALIDACI√ìN DE SEGURIDAD
        if (!fecha) { alert("Pon una fecha primero."); return; }
        if (API_KEY.includes("BORRA_ESTO") || API_KEY.length < 10) { 
            alert("‚ö†Ô∏è ERROR DE ARQUITECTO:\n\nNo has pegado tu API Key en el c√≥digo.\nBusca la l√≠nea 56 y pega tu clave."); 
            return; 
        }

        // MODO CARGANDO
        btn.disabled = true;
        btn.innerHTML = ">>> CONTACTANDO A GOOGLE...";
        consola.innerHTML += ">>> ENVIANDO SE√ëAL A LA NUBE...<br>";

        // EL PROMPT
        const prompt = `Act√∫a como el Sistema Dante. Basado en la fecha ${fecha}, genera una cita literaria corta (inventada o real) de terror/misterio. Responde SOLO este JSON: {"frase": "cita", "autor": "nombre", "libro": "obra"}`;

        try {
            // CONEXI√ìN
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await response.json();

            // ‚ö†Ô∏è AQU√ç ES DONDE CAPTURAMOS TU ERROR
            if (data.error) {
                throw new Error("GOOGLE DICE: " + data.error.message);
            }
            if (!data.candidates) {
                throw new Error("LA IA NO RESPONDI√ì (Respuesta vac√≠a).");
            }

            // √âXITO
            const texto = data.candidates[0].content.parts[0].text;
            const jsonLimpio = texto.replace(/```json|```/g, '').trim();
            respuestaCorrecta = JSON.parse(jsonLimpio);

            document.getElementById('setup-form').classList.add('hidden');
            document.getElementById('quiz-zone').classList.remove('hidden');
            document.getElementById('quote-display').innerText = `"${respuestaCorrecta.frase}"`;
            consola.innerHTML += "<span style='color:cyan'>>>> CONEXI√ìN EXITOSA.</span><br>";

        } catch (error) {
            console.error(error);
            // MOSTRAMOS EL ERROR EN PANTALLA ROJA
            consola.innerHTML += `<div class="error-msg">‚ùå ERROR CR√çTICO:<br>${error.message}</div>`;
            btn.disabled = false;
            btn.innerHTML = "REINTENTAR";
        }
    }

    function verificarRespuesta() {
        const input = document.getElementById('author-guess').value.toLowerCase();
        const real = respuestaCorrecta.autor.toLowerCase();
        
        if (real.includes(input) && input.length > 2) {
            document.getElementById('feedback-msg').innerHTML = `<span style="color:cyan">CORRECTO. Autor: ${respuestaCorrecta.autor}</span>`;
            document.getElementById('console').innerHTML += ">>> ACCESO CONCEDIDO.<br>";
        } else {
            document.getElementById('feedback-msg').innerHTML = `<span style="color:red">INCORRECTO. Intenta de nuevo.</span>`;
        }
    }
</script>
</body>
</html>
